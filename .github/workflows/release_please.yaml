---
name: Release-please - Automatic Semver compliant tags ðŸ¤–ðŸª§

on:
    workflow_call:
        inputs:
            APP_ID:
                description: "The APP id to auth with"
                required: true
                type: string
        secrets:
            APP_PRIVATE_KEY:
                description: "Private Key of app to auth with"
                required: true

# these are the permissions required for release-please to do its job
permissions:
    contents: write
    issues: write
    pull-requests: write

jobs:
    # of course - in scaled orgs, this would be a reusable workflow
    release-please:
        runs-on: ubuntu-latest
        env:
            APP_ID: ${{ inputs.APP_ID }}
            APP_PRIVATE_KEY: ${{ secrets.APP_PRIVATE_KEY}}
        steps:
            - uses: actions/create-github-app-token@v2
              id: app-token
              with:
                  app-id: ${{ env.APP_ID }}
                  private-key: ${{ env.APP_PRIVATE_KEY}}
                  # for now - we wont do anything more fancy than the default release-please stuff.
                  # I would recommend in some cases a "rolling major" version
                  # to reduce the need to update to really specific tags in low-risk envs
                  # the action does ouput a major tag, just for cases like those :)
            - uses: googleapis/release-please-action@v4
              with:
                  token: ${{ steps.app-token.outputs.token }}
                  release-type: terraform-module
